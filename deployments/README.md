# CI/CD –∏ –î–µ–ø–ª–æ–π

–≠—Ç–∞ –ø–∞–ø–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Ñ–∞–π–ª—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –¥–µ–ø–ª–æ–µ–º –∏ CI/CD –ø—Ä–æ–µ–∫—Ç–∞ Cerera.

## üìÅ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ

- **Dockerfile** - Docker –æ–±—Ä–∞–∑ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Cerera
- **docker-compose.yml** - Compose —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Prometheus + Grafana (—Ç–æ–ª—å–∫–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- **docker-compose-single.yml** - Compose —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞ 1 –Ω–æ–¥—ã + Prometheus + Grafana (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- **docker-compose-full.yml** - Compose —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞ 5 –Ω–æ–¥ + Prometheus + Grafana (–ø–æ–ª–Ω—ã–π —Å—Ç–µ–∫)
- **docker-compose-5nodes.yml** - Compose —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞ 5 –Ω–æ–¥ (–±–µ–∑ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞)
- **docker-compose-9nodes.yml** - Compose —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞ 9 –Ω–æ–¥
- **docker-compose-15nodes.yml** - Compose —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞ 15 –Ω–æ–¥
- **deploy.sh** - –°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
- **deploy-local.sh** - –°–∫—Ä–∏–ø—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è
- **DEPLOYMENT.md** - –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –¥–µ–ø–ª–æ—é
- **PROMETHEUS_SETUP.md** - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∑–∞–ø—É—Å–∫—É —Å Prometheus
- **reset-grafana-password.ps1** / **reset-grafana-password.sh** - –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è Grafana
- **SYSTEMD-GUIDE.md** - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ systemd —Å–µ—Ä–≤–∏—Å–∞
- **prometheus.yml** - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (5 –Ω–æ–¥)
- **prometheus-single.yml** - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (1 –Ω–æ–¥–∞)

## üê≥ Docker

### –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞

```bash
# –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
docker build -f ci-cd/Dockerfile -t cerera:latest .
```

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ docker-compose

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –û–¥–Ω–∞ –Ω–æ–¥–∞ + Prometheus + Grafana (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```bash
# –ò–∑ –ø–∞–ø–∫–∏ ci-cd
cd ci-cd
docker-compose -f docker-compose-single.yml up -d

# –ò–ª–∏ –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
docker-compose -f ci-cd/docker-compose-single.yml up -d
```

–≠—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç 1 –Ω–æ–¥—É Cerera –≤–º–µ—Å—Ç–µ —Å Prometheus –∏ Grafana. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–ª–Ω—ã–π —Å—Ç–µ–∫ (5 –Ω–æ–¥ + Prometheus + Grafana)

```bash
# –ò–∑ –ø–∞–ø–∫–∏ ci-cd
cd ci-cd
docker-compose -f docker-compose-full.yml up -d

# –ò–ª–∏ –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
docker-compose -f ci-cd/docker-compose-full.yml up -d
```

–≠—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç 5 –Ω–æ–¥ Cerera –≤–º–µ—Å—Ç–µ —Å Prometheus –∏ Grafana –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

#### –í–∞—Ä–∏–∞–Ω—Ç 3: –¢–æ–ª—å–∫–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus + Grafana)

```bash
# –ò–∑ –ø–∞–ø–∫–∏ ci-cd
cd ci-cd
docker-compose up -d

# –ò–ª–∏ –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
docker-compose -f ci-cd/docker-compose.yml up -d
```

–≠—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ Prometheus –∏ Grafana (–¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–æ–¥, –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –æ—Ç–¥–µ–ª—å–Ω–æ).

#### –í–∞—Ä–∏–∞–Ω—Ç 4: –¢–æ–ª—å–∫–æ –Ω–æ–¥—ã (–±–µ–∑ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞)

```bash
# –ò–∑ –ø–∞–ø–∫–∏ ci-cd
cd ci-cd
docker-compose -f docker-compose-5nodes.yml up -d
```

–í –≤–∞—Ä–∏–∞–Ω—Ç–∞—Ö —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –Ω–æ–¥–∞–º–∏ (3, 5, 9, 15 –Ω–æ–¥) –≤–º–µ—Å—Ç–µ —Å –Ω–æ–¥–∞–º–∏ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è **Block Observer** ‚Äî –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –±–ª–æ–∫–æ–≤. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: **http://localhost:8080** (–∏–ª–∏ http://localhost:8080/block_observer.html). –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å URL –Ω–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä http://localhost:1337/app, http://localhost:1338/app) –∏ –ø–æ–ª—É—á–∞—Ç—å –±–ª–æ–∫–∏ –ø–æ –∏–Ω–¥–µ–∫—Å—É.

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –∑–∞–ø—É—Å–∫–µ —Å Prometheus —Å–º. [PROMETHEUS_SETUP.md](./PROMETHEUS_SETUP.md)

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤—Ä—É—á–Ω—É—é

```bash
docker run -d \
  --name cerera-node \
  -p 1337:1337 \
  -p 31000:31000 \
  -v $(pwd)/cerera-data:/app/data \
  --restart unless-stopped \
  cerera:latest
```

## üöÄ –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ deploy.sh

```bash
./ci-cd/deploy.sh user@server-ip
```

### –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π

–°–º. –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ [DEPLOYMENT.md](./DEPLOYMENT.md)

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É—Ç–∏–ª–∏—Ç—ã

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ docker-compose:
- **Prometheus**: http://localhost:9090
- **Grafana**: http://localhost:3100 (admin/admin)
- **Block Observer** (–ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ 3/5/9/15 –Ω–æ–¥): http://localhost:8080 ‚Äî –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è URL –Ω–æ–¥ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –±–ª–æ–∫–æ–≤

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- Dockerfile –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `COPY . .`)
- docker-compose –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞–ø–∫—É grafana –≤ —ç—Ç–æ–π –ø–∞–ø–∫–µ (deployments/grafana)
- prometheus.yml –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —ç—Ç–æ–π –ø–∞–ø–∫–µ –∏ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

