# Синхронизация топологии в GIGEA Consensus

## Обзор

Добавлена автоматическая синхронизация массивов `Peers` и `Voters` между всеми узлами сети через топик консенсуса после получения сообщения "change topology".

## Как это работает

### 1. Триггер синхронизации

Синхронизация запускается автоматически в следующих случаях:
- При добавлении нового пира (`AddPeer`)
- При удалении пира (`RemovePeer`)
- При получении уведомления об изменении топологии от другого узла

### 2. Процесс синхронизации

1. **Отправка запроса синхронизации**: Узел, обнаруживший изменение топологии, отправляет сообщение `topology_sync` через топик консенсуса
2. **Ответы от других узлов**: Все узлы, получившие запрос, отвечают своими текущими массивами `Peers` и `Voters`
3. **Объединение информации**: Каждый узел объединяет полученную информацию со своей локальной топологией

### 3. Типы сообщений

- `topology_sync` - запрос на синхронизацию топологии
- `topology_sync_response` - ответ с текущей топологией узла
- `topology_change` - уведомление об изменении топологии

## Новые функции

### SimpleConsensus

- `synchronizeTopologyWithPeers()` - отправляет запрос на синхронизацию
- `NotifyTopologySync()` - обрабатывает сообщения синхронизации
- `respondToTopologySync()` - отвечает на запросы синхронизации
- `mergeTopologyInfo()` - объединяет информацию о топологии

### Transport Layer

- `NotifyTopologySync()` - пересылает сообщения синхронизации в консенсус
- `NotifyTopologyChange()` - пересылает уведомления об изменении топологии

### Network Layer

- Обработка новых типов сообщений в `routeMessage()`
- Автоматическая маршрутизация сообщений синхронизации

## Преимущества

1. **Автоматическая синхронизация**: Не требует ручного вмешательства
2. **Консистентность**: Все узлы имеют одинаковую информацию о топологии
3. **Масштабируемость**: Работает с любым количеством узлов
4. **Надежность**: Использует существующую инфраструктуру консенсуса

## Пример использования

```go
// Синхронизация запускается автоматически при изменении топологии
consensus.AddPeer(newPeerAddress)
// Автоматически отправляется сообщение topology_sync
// Все узлы отвечают своими топологиями
// Происходит объединение и синхронизация
```

## Безопасность

- Синхронизация происходит только между узлами с одинаковым или более высоким термином
- Все изменения логируются для аудита
- Поддерживается обратная совместимость с существующим кодом
